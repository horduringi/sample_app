<div ng-controller="FormCtrl" ng-app="formApp">
  <%= form_for(@journal) do |j| %>
  <div class="row-fluid">
    <div class="span3">
      <h2>Radiotherapy</h2>
    </div>
    <div style="margin-top:10px;"class="span2">
      <%= j.select :radiotherapy, options_from_collection_for_select(NoYesUnknown.all, :id,:noyesunknown_combo, @journal.radiotherapy), {}, {"ng-model" => "journal.radiotherapy"} %> 
    </div>
  </div>
<!--Allt sem tilheyrir radiotherapy bara birt ef Yes í Radiotherapy-->  
  <div ng-show="journal.radiotherapy == '2'">
    <div class="row-fluid">
      <div class="span3">
          <p><b>External beam radiotherapy:</b></p>
      </div>
      <div class="span2">
        <%= j.select :externalbeamradiotherapy, options_from_collection_for_select(NoYes.all, :id,:noyes_combo, @journal.externalbeamradiotherapy), {}, {"ng-model" => "journal.externalbeamreadiotherapy"} %> 
      </div>
    </div>
  <!--Allt sem tilheyrir External beam radiotherapy birtist ef Yes í því comboi-->
    <div ng-show="journal.externalbeamreadiotherapy == '2'">
      <div class="row-fluid">
        <div class="span3">
          <p>Date of start:</p>
        </div>
        <div class="span6">
          <%= j.date_select :externalbeamradiotherapydateofstart, :start_year => 1970, :end_year => Time.now.year, :default => @journal.externalbeamradiotherapydateofstart, :include_blank=> true, order: [:day, :month, :year] %>
        </div>
      </div>
      <div class="row-fluid">
        <div class="span3">
          <p>Date of completion:</p>
        </div>
        <div class="span6">
          <%= j.date_select :externalbeamradiotherapydateofcompletion, :start_year => 1970, :end_year => Time.now.year, :default => @journal.externalbeamradiotherapydateofcompletion, :include_blank=> true, order: [:day, :month, :year] %>
        </div>
      </div>
      <div class="row-fluid">
        <div class="span3">
            <p>Treating hospital(-s) and department, radiotherapy:</p>
        </div>
        <div class="span9">
            <%= j.text_area :externalbeamradiotherapytreatinghospital, :cols => "30", :rows => "7" %>
        </div>
      </div>
      <div class="row-fluid">
        <div class="span4">
          <p class="infoSmallRed">Radiotherapy records AND relevant text in the medical record copied*:</p>
        </div>
        <div class="span6" style=margin-top:5px;>
          <%= j.date_select :externalbeamradiotherapyrecordscopied, :start_year => 1970, :end_year => Time.now.year, :default => @journal.externalbeamradiotherapyrecordscopied, :include_blank=> true, order: [:day, :month, :year] %>
        </div>
      </div>
      <div class="row-fluid">
        <div class="span6 offset4">
          <p class="infoSmall" style=margin-top:-15px;>*copied WITHOUT any personal identifications, only including a front page (e.g. with the ALiCCS study number).</p>
        </div>
      </div>
    </div>
    <div class="row-fluid">
      <div class="span3">
          <p><b>Brachytherapy:</b></p>
      </div>
      <div class="span2">
        <%= j.select :brachytherapy, options_from_collection_for_select(NoYes.all, :id,:noyes_combo, @journal.brachytherapy), {}, {"ng-model" => "journal.brachytherapy"} %>
      </div>
    </div>
  <!--Allt sem tilheyrir Brachytherapy birtist ef Yes í því comboi-->
    <div ng-show="journal.brachytherapy == '2'">
      <div class="row-fluid">
        <div class="span3">
          <p>Date of start:</p>
        </div>
        <div class="span6">
          <%= j.date_select :brachytherapydateofstart, :start_year => 1970, :end_year => Time.now.year, :default => @journal.brachytherapydateofstart, :include_blank=> true, order: [:day, :month, :year] %>
        </div>
      </div>
      <div class="row-fluid">
        <div class="span3">
          <p>Date of completion:</p>
        </div>
        <div class="span6">
          <%= j.date_select :brachytherapydateofcompletion, :start_year => 1970, :end_year => Time.now.year, :default => @journal.brachytherapydateofcompletion, :include_blank=> true, order: [:day, :month, :year] %>
        </div>
      </div>
      <div class="row-fluid">
        <div class="span3">
            <p>Treating hospital(-s) and department, radiotherapy:</p>
        </div>
        <div class="span9">
            <%= j.text_area :brachytherapytreatinghospital, :cols => "30", :rows => "7" %>
        </div>
      </div>
      <div class="row-fluid">
        <div class="span4">
          <p class="infoSmallRed">Radiotherapy records AND relevant text in the medical record copied*:</p>
        </div>
        <div class="span6" style=margin-top:5px;>
          <%= j.date_select :brachytherapyrecordscopied, :start_year => 1970, :end_year => Time.now.year, :default => @journal.brachytherapyrecordscopied, :include_blank=> true, order: [:day, :month, :year] %>
        </div>
      </div>
      <div class="row-fluid">
        <div class="span6 offset4">
          <p class="infoSmall" style=margin-top:-15px;>*copied WITHOUT any personal identifications, only including a front page (e.g. with the ALiCCS study number).</p>
        </div>
      </div>
    </div>
    <div class="row-fluid">
      <div class="span3">
          <p><b>Internal (metabolic) radiotherapy:</b></p>
      </div>
      <div class="span2">
        <%= j.select :internalradiotherapy, options_from_collection_for_select(NoYes.all, :id,:noyes_combo, @journal.internalradiotherapy), {}, {"ng-model" => "journal.internalradiotherapy"} %> 
      </div>
    </div>
  <!--Allt sem tilheyrir Internal radiotherapy birtist ef Yes í því comboi-->
    <div ng-show="journal.internalradiotherapy == '2'">
      <div class="row-fluid">
        <div class="span3">
          <p>Date of start:</p>
        </div>
        <div class="span6">
          <%= j.date_select :internalradiotherapydateofstart, :start_year => 1970, :end_year => Time.now.year, :default => @journal.internalradiotherapydateofstart, :include_blank=> true, order: [:day, :month, :year] %>
        </div>
      </div>
      <div class="row-fluid">
        <div class="span3">
            <p>Treating hospital(-s) and department, radiotherapy:</p>
        </div>
        <div class="span9">
            <%= j.text_area :internalradiotherapytreatinghospital, :cols => "30", :rows => "7" %>
        </div>
      </div>
      <div class="row-fluid">
        <div class="span4">
          <p class="infoSmallRed">Radiotherapy records AND relevant text in the medical record copied*:</p>
        </div>
        <div class="span6" style=margin-top:5px;>
          <%= j.date_select :internalradiotherapyrecordscopied, :start_year => 1970, :end_year => Time.now.year, :default => @journal.internalradiotherapyrecordscopied, :include_blank=> true, order: [:day, :month, :year] %>
        </div>
      </div>
      <div class="row-fluid">
        <div class="span6 offset4">
          <p class="infoSmall" style=margin-top:-15px;>*copied WITHOUT any personal identifications, only including a front page (e.g. with the ALiCCS study number).</p>
        </div>
      </div>
    </div>
  </div>
  <div class="row-fluid">
    <div class="span3">
        <h2><b>Surgery</b></h2>
    </div>
    <div class="span2" style="margin-top:10px;">
      <%= j.select :surgery, options_from_collection_for_select(NoYes.all, :id,:noyes_combo, @journal.surgery), {}, {"ng-model" => "journal.surgery"} %> 
    </div>
  </div>
  <!--Allt sem tilheyrir Surgery birtist ef Yes í því comboi-->
  <%= j.fields_for :surgeries do |builder| %>
    <%= render 'surgery_fields', f: builder %>
  <% end %>
  <div ng-show="journal.surgery=='2'">
    <p class="infoSmall">Please click "Add surgery" for each surgery and fill in the information.</p>
  <%= link_to_add_fields "Add surgery", j, :surgeries %>
  </div>
  <br><br>
  <div class="row-fluid">
    <div class="span3">
        <h2><b>Chemotherapy</b></h2>
    </div>
    <div class="span2" style="margin-top:10px;">
      <%= j.select :chemotherapy, options_from_collection_for_select(NoYes.all, :id,:noyes_combo, @journal.chemotherapy), {}, {"ng-model" => "journal.chemotherapy"} %> 
    </div>
  </div>
  <div class="row-fluid">
    <div class="span7 offset3" style="margin-top:-15px;">
      <p class="infoSmall">and other relevant drugs (see instructions and drug codes in Appendix I)</p>
    </div>
  </div>
  <div ng-show="journal.chemotherapy=='2'">
    <div class="row-fluid">
      <div class="span3">
        <p>Date of initiation of chemotherapy:</p>
      </div>
      <div class="span6" style="margin-top:10px;">
        <%= j.date_select :chemotherapydateinitiation, :start_year => 1970, :end_year => Time.now.year, :default => @journal.chemotherapydateinitiation, :include_blank=> true, order: [:day, :month, :year] %>
      </div>
    </div>
    <div class="row-fluid">
      <div class="span3">
        <p>Date of all chemotherapy completed:</p>
      </div>
      <div class="span6">
        <%= j.date_select :chemotherapydatecompletion, :start_year => 1970, :end_year => Time.now.year, :default => @journal.chemotherapydatecompletion, :include_blank=> true, order: [:day, :month, :year] %>
      </div>
    </div>
    <div class="row-fluid">
      <div class="span3">
        <p>Body surface (m<sup>2</sup>) <b>at diagnosis</b>:</p>
      </div>
      <div class="span2">
        <%= j.number_field :chemotherapybodysurfaceatdiagnosis, {step: 0.01, min: 0} %>
      </div>
    </div>
    <div class="row-fluid">
      <div class="span3">
        <p>Weight (kg):</p>
      </div>
      <div class="span2">
        <%= j.number_field :chemotherapyweightatdiagnosis, {step: 0.1, min: 0} %>
      </div>
    </div>
    <div class="row-fluid">
      <div class="span3">
        <p>Height (cm):</p>
      </div>
      <div class="span2">
        <%= j.number_field :chemotherapyheightatdiagnosis, {step: 0.1, min: 0} %>
      </div>
    </div>
    <div class="row-fluid">
      <div class="span3">
          <p>Was body surface estimated?</p>
      </div>
      <div class="span2">
          <%= j.select :chemotherapyestimated, options_from_collection_for_select(NoYes.all, :id,:noyes_combo), :include_blank => true %> 
      </div>
    </div>
      <%= j.fields_for :chemo_therapies do |builder| %>
        <%= render 'chemo_therapy_fields', f: builder %>
      <% end %>
      <p class="infoSmallRed">If cancer treatment extends through out more than one year please click "Add chemotherapy year" for each year and give a <b>yearly body surface</b> (m<sup>2</sup>)</p>
      <%= link_to_add_fields "Add chemotherapy year", j, :chemo_therapies %>
    <br><br>
    <table class="span12" style="position:relative;left:-55px">
      <thead>
        <th style="width:260px">Cytostatic drug (code - name)</th>
        <th style="width:200px">Total cumulated dose<br>(mg/m<sup>2</sup> or units/m<sup>2</sup>)</th>
        <th style="width:110px">Dose quality</th>
        <th style="width:260px">Anthracyclines: bolus vs. inf**</th>
        <th></th>
      </thead>
      <tbody>
    <%= j.fields_for :cytostatic_drug_given do |builder| %>
      <%= render 'cytostatic_drug_given_fields', f: builder %>
    <% end %>
      </tbody>
    </table>

    <%= link_to_add_fields "Add cytostatic drug given", j, :cytostatic_drug_given %>
    <div class="row-fluid">
      <div class="span12">
        <p class=infoBox><b>In case of anthracycline use:</b><br>**Please give the average rate of administration for the <b>majority</b> of anthracycline doses given.<br>Anthracyclines: <b>doxorubicin</b>, Adriamycin&reg;, Adria&reg;; <b>daunorubicin</b>, Daunomycin&reg;, Cerubidine&reg;; <b>idarubicin</b>, Idamycin&reg;; mitoxantrone, Novantrone&reg;; <b>epirubicine</b><br>
        </p>
      </div>
      <div class="span3">
        <p>Were cardioprotectants used?</p>
      </div>
      <div class="span2">
        <%= j.select :chemocardioprotectants, options_from_collection_for_select(NoYes.all, :id,:noyes_combo), {}, {"ng-model" => "journal.chemocardioprotectants"} %>
      </div>
    </div>
    <div class="row-fluid">
      <div class="span8 offset3">
        <p class="infosmall" style="margin-top:-15px;">Cardioprotectants: Cardioxane, Zinecard or DexrazOxane</p>
      </div>
    </div>
    <div class="row-fluid">
      <div class="span4">
        <p><b>Treatment protocol (if applicable):</b></p>
        <p class="infoSmall" style="margin-top:-10px;">If the patient is treated (more or less) according to a protocol, please write the name of the protocol.</p>
      </div>
      <div class="span8">
          <%= j.text_area :chemotherapytreatmentprotocolspec, :cols => "30", :rows => "3" %>
      </div>
    </div>
    <div class="row-fluid">
      <p><b>Central venous catheter (CVC)</b></p>
    </div>
    <div class="row-fluid">
      <div class="span3">
        <p>CVC inserted?</p>
      </div>
      <div class="span2">
        <%= j.select :chemotherapyCVC, options_from_collection_for_select(NoYesUnknown.all, :id,:noyesunknown_combo, @journal.chemotherapyCVC), {}, {"ng-model" => "journal.chemotherapyCVC"} %> 
      </div>
    </div>
    <div ng-show="journal.chemotherapyCVC=='2'">
      <div class="row-fluid">
        <div class="span4">
          <p>If yes, how many in total were inserted during the treatment period?</p>
        </div>
        <div class="span2">
          <!--Athuga-->
        </div>
      </div>
      <div class="row-fluid">
        <div class="span3">
          <p>Date (month and year) of insertion of the first CVC:</p>
        </div>
        <div class="span6" style="margin-top:10px;">
          <%= j.date_select :chemotherapyinsertiondatecvc, {:start_year => 1970, :end_year => Time.now.year, :default => @journal.chemotherapyinsertiondatecvc, :include_blank=> true, order: [:month, :year]}, {:class => "date_generic"}  %>
        </div>
      </div>
      <div class="row-fluid">
        <div class="span3">
          <p>Date of permanent removal:</p>
        </div>
        <div class="span6" style="margin-top:10px;">
          <%= j.date_select :chemotherapypermanentremovaldate, {:start_year => 1970, :end_year => Time.now.year, :default => @journal.chemotherapypermanentremovaldate, :include_blank=> true, order: [:month, :year]}, {:class => "date_generic"}  %>
        </div>
      </div>
    </div>  
  </div>
  <div class="row-fluid">
    <div class="span4">
        <h2><b>Bone marrow transplantation</b></h2><p class="infoSmall" style="margin-top:-20px;">(BMT, Stem cell transplant, SCT)</p>
    </div>
    <div class="span2" style="margin-top:10px;">
      <%= j.select :bonemarrowtransplantation, options_from_collection_for_select(NoYes.all, :id,:noyes_combo, @journal.bonemarrowtransplantation), {}, {"ng-model" => "journal.bonemarrowtransplantation"} %> 
    </div>
  </div>
  <%= j.fields_for :bone_marrow_transplantations do |builder| %>
  <%= render 'bone_marrow_transplantation_fields', f: builder %>
  <% end %>
  <div ng-show="journal.bonemarrowtransplantation == '2'">
  <%= link_to_add_fields "Add bone marrow transplantation", j, :bone_marrow_transplantations %>
  </div>

    <div align="right">
        <%= j.submit "Add relapse", class: "btn btn-large btn-primary" %>
        <%= j.submit "No more relapses", class: "btn btn-large" %>

  </div>
      
      <% end %>
</div>